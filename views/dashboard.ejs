<!doctype html>
<html lang="en">
    <head>
        <!-- Required meta tags -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <!-- Bootstrap CSS -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
        <link rel="stylesheet" href="/css/stu.css">

        <title>Welcome to Dashboard</title>
    </head>
    
    <body>
    <!-- NAVBAR -->
        <div class="navbar navbar-expand-md navbar-light sticky-top" style="background-color: #e3f2fd;">
            <div class="container-fluid mt-2">
            <!-- NAVBAR BRAND -->
            <div class="navbar-brand ms-3">
                <img class="align-text-bottom mb-1" height="40px" width="40px" src="/logo.png" alt="Anna University Logo">
                <ul style="list-style-type:none;display:inline-block;padding:0;margin:0;">
                <li style="font-size:18px">Department of Information Technology</li>
                <li style="font-size:13px">Anna University, MIT Campus</li>
                </ul>
            </div>
            <!-- NAVBAR TOGGLER -->
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarText" aria-controls="navbarText" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <!-- NAVBAR LINKS -->
            <div class="collapse navbar-collapse justify-content-end me-auto" id="navbarText">
                <ul class="navbar-nav me-5">
                <li class="nav-item"> <a class="nav-link active" aria-current="page" href="/login">HOME</a></li>
                <li class="nav-item"> <a class="nav-link" href="">LOG OUT</a></li>
                </ul>
            </div>
            </div>
        </div>

    <!-- MAIN SEARCH BAR  -->
        <h1 class="mt-3 ms-auto me-auto" style="max-width: 60vw;text-align: center;">Search for any books..</h1>
        <form action="/dashboard" method="post">
            <div class="input-group mt-4 ms-auto me-auto" style="max-width: 75vw;">
            
                <button id="dropdownText" class="btn btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false"> <%= searchConfig[0]['searchTag'] %> </button>
                <ul class="dropdown-menu">
                    <li><a href="#" onclick="dropDownTextToggle('Book Name')" class="dropdown-item">Book Name</a></li>
                    <li><a href="#" onclick="dropDownTextToggle('Author Name')" class="dropdown-item">Author Name</a></li>
                    <li><a href="#" onclick="dropDownTextToggle('ISBN')" class="dropdown-item">ISBN</a></li>
                    <li><a href="#" onclick="dropDownTextToggle('Genre')" class="dropdown-item">Genre</a></li>
                </ul>
                <input type="text" name="searchFactor" id="disabledSearchFactor" value="<%= searchConfig[0]['searchTag'] %>" style="display: none;">
                <input type="text" class="form-control" name="searchBar" placeholder="Example: 12 Rules to Learn to Code...." value="<%= searchConfig[0]['searchBarText'] %>">
                <button class="btn btn-outline-secondary" type="submit">  Go  </button>
           
            </div>
         </form>

    <!-- RESULTS TABLE  -->
        <table class="table table-striped table-hover mt-5 ms-auto me-auto" style="max-width: 90vw; text-align: center;">
            <thead>
                <tr>
                    <th>S. NO</th>
                    <th>Book Name</th>
                    <th>Author</th>
                    <th>Year</th>
                    <th>Genre</th>
                    <th>Price</th>
                    <th>ISBN</th>
                    <th>Availability</th>
                    <th>Borrow</th>
                </tr>
            </thead>
            <tbody>
            <% if (searchData) { %>
                <% for (let data in searchData){ %>
                <tr id="<%= searchData[data]['isbn'] %>A">
                    <td><%= Number(data) + 1 %></td>
                    <td><%= searchData[data]['name'] %></td>
                    <td><%= searchData[data]['author'] %></td>
                    <td><%= searchData[data]['year'] %></td>
                    <td><%= searchData[data]['genre'] %></td>
                    <td><%= searchData[data]['price'] %></td>
                    <td><%= searchData[data]['isbn'] %></td>
                    <% if (searchData[data]['noOfCopies'] >= 1 ) { %>
                        <td>Yes</td>
                        <td><button class="btn btn-outline-secondary" id="<%= searchData[data]['isbn'] %>" type="button" onclick="addBook(this.id)">Lend Book</button></td>
                    <% } else { %>
                        <td>No</td>
                        <td><button class="btn btn-outline-secondary" type="button" disabled>Lend Book</button></td>
                    <% } %>
                </tr>
            <% } } %>
            </tbody>
        </table>
        <% if (searchConfig[0]['noOfSearchResults'] <= 0) { %>
            <p class="text-primary ms-auto me-auto mt-2" style="max-width: 15vw; text-align: center;"> Oops! No books found. </p>
        <% } %>

    <!-- SUBMIT BUTTON -->
        <div class="mt-4 text-center">
            <form action="/confirmBooks" method="post" id="bookLend">
                <input type="text" name="booksSelected" id="booksSelectedInp" style="display: none;">
                <button class="btn btn-outline-primary disabled" id="subBtn" type="submit">Lend Books</button>
            </form>
            
        </div>
        

    <!-- SELECTED BOOKS TABLE  -->
        <h1 class="mt-5 ms-auto me-auto" style="max-width: 60vw;text-align: center;">Selected Books</h1>
        <table id="selectedTable" class="table table-striped table-hover mt-5 ms-auto me-auto" style="max-width: 90vw; text-align: center;">
            <thead>
                <tr>
                    <th>Book Name</th>
                    <th>Author</th>
                    <th>Year</th>
                    <th>Genre</th>
                    <th>Price</th>
                    <th>ISBN</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>

    <!-- PREVIOUSLY BORROWED BOOKS TABLE -->
    <h1 class="mt-5 ms-auto me-auto" style="max-width: 60vw;text-align: center;">Previously Borrowed Books</h1>
    <table class="table table-striped table-hover mt-5 ms-auto me-auto" style="max-width: 90vw; text-align: center;">
        <thead>
            <tr>
                <th>S. NO</th>
                <th>Book Name</th>
                <th>Author</th>
                <th>Year</th>
                <th>Genre</th>
                <th>Price</th>
                <th>ISBN</th>
                <th>Date Borrowed</th>
                <th>Date Returned</th>
                <th>Fine</th>
            </tr>
        </thead>

        <% if (prevBooksData) { %>
            <% for (let data in prevBooksData){ %>
                <tbody>
                    <tr>
                        <td>
                            <%= Number(data) + 1 %>
                        </td>
                        <td>
                            <%= prevBooksData[data]['name'] %>
                        </td>
                        <td>
                            <%= prevBooksData[data]['author'] %>
                        </td>
                        <td>
                            <%= prevBooksData[data]['year'] %>
                        </td>
                        <td>
                            <%= prevBooksData[data]['genre'] %>
                        </td>
                        <td>
                            <%= prevBooksData[data]['price'] %>
                        </td>
                        <td>
                            <%= prevBooksData[data]['isbn'] %>
                        </td>
                        <td>
                            <%= prevBooksData[data]['dateBorrowed'] %>
                        </td>
                        <td>
                            <%= prevBooksData[data]['dateReturned'] %>
                        </td>
                        <td>
                            <%= prevBooksData[data]['fine'] %>
                        </td>
                    </tr>
                </tbody>
            <% } } %>
        
    </table>
        










        <br><br><br>
        <br><br><br>
        <br><br><br>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
        <script src="/stuScript.js" type="text/javascript"></script>
        
    </body>
</html>
